@model CatalogoWeb.Models.Product

<h2>Crear Producto</h2>

<div asp-validation-summary="All" style="color:red"></div>

<form asp-controller="Product" asp-action="Create" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()
    
    <div>
        <label>Nombre</label>
        <input asp-for="Name" />
        <span asp-validation-for="Name" style="color:red"></span>
    </div>

    <div>
        <label>Cantidad</label>
        <input asp-for="Quantity" type="number" />
        <span asp-validation-for="Quantity" style="color:red"></span>
    </div>

    <div>
        <label>Precio</label>
        <input asp-for="Price" type="number" step="0.01" />
        <span asp-validation-for="Price" style="color:red"></span>
    </div>

    <div>
        <label>Categoria</label>
        <select asp-for="CategoryId">
            <option value="">Seleccione</option>
            @foreach(var c in ViewBag.Categories)
            {
                <option value="@c.Id">@c.Name</option>
            }
        </select>
        <span asp-validation-for="CategoryId" style="color:red"></span>
    </div>

    <div>
        <label>Imagenes (m√≠nimo 1)</label>
        <input type="file" id="imageFiles" name="files" multiple accept=".jpg,.png" />
    </div>

    <div id="principalSelector" style="margin-top:10px; display:none;">
        <label>Seleccione la imagen principal:</label>
        <div id="radioContainer"></div>
    </div>

    <div style="margin-top:10px;">
        <button type="submit">Guardar</button>
    </div>
</form>

@section Scripts {
<script>
    // Cuando se seleccionan archivos, generamos radio buttons para elegir principal
    const fileInput = document.getElementById("imageFiles");
    const radioContainer = document.getElementById("radioContainer");
    const principalDiv = document.getElementById("principalSelector");

    fileInput.addEventListener("change", function() {
        radioContainer.innerHTML = ""; // limpiar
        if(this.files.length > 1) {
            principalDiv.style.display = "block";
            for(let i=0; i < this.files.length; i++) {
                const file = this.files[i];
                const label = document.createElement("label");
                label.style.display = "block";
                const radio = document.createElement("input");
                radio.type = "radio";
                radio.name = "principalIndex";
                radio.value = i;
                if(i === 0) radio.checked = true; // primera por defecto
                label.appendChild(radio);
                label.appendChild(document.createTextNode(" " + file.name));
                radioContainer.appendChild(label);
            }
        } else {
            principalDiv.style.display = "none";
        }
    });
</script>
}