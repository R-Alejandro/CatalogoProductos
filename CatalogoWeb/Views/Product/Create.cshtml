@model CatalogoWeb.Models.Product

<h2>Crear Producto</h2>

<div asp-validation-summary="All" style="color:red"></div>

<form asp-controller="Product" asp-action="Create" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()
    
    <div>
        <label>Nombre</label>
        <input asp-for="Name" />
        <span asp-validation-for="Name" style="color:red"></span>
    </div>

    <div>
        <label>Cantidad</label>
        <input asp-for="Quantity" type="number" />
        <span asp-validation-for="Quantity" style="color:red"></span>
    </div>

    <div>
        <label>Precio</label>
        <input asp-for="Price" type="number" step="0.01" />
        <span asp-validation-for="Price" style="color:red"></span>
    </div>

    <div>
        <label>Categoria <span style="color:red">*</span></label>
        <select asp-for="CategoryId" id="categorySelect">
            <option value="">Seleccione una categoría</option>
            @foreach(var c in ViewBag.Categories)
            {
                <option value="@c.Id">@c.Name</option>
            }
        </select>
        <span id="categoryError" style="color:red; display:none;">Debe seleccionar una categoría</span>
    </div>

    <div>
        <label>Imagenes (mínimo 1)</label>
        <input type="file" id="imageFiles" name="files" multiple accept=".jpg,.png" />
    </div>

    <div id="principalSelector" style="margin-top:10px; display:none;">
        <label>Seleccione la imagen principal:</label>
        <div id="radioContainer"></div>
    </div>

    <div style="margin-top:10px;">
        <button type="submit" id="submitBtn">Guardar</button>
    </div>
</form>

@section Scripts {
<script>
    const fileInput = document.getElementById("imageFiles");
    const radioContainer = document.getElementById("radioContainer");
    const principalDiv = document.getElementById("principalSelector");
    const categorySelect = document.getElementById("categorySelect");
    const categoryError = document.getElementById("categoryError");
    const submitBtn = document.getElementById("submitBtn");

    fileInput.addEventListener("change", function() {
        radioContainer.innerHTML = "";
        if(this.files.length > 1) {
            principalDiv.style.display = "block";
            for(let i=0; i < this.files.length; i++) {
                const file = this.files[i];
                const label = document.createElement("label");
                label.style.display = "block";
                const radio = document.createElement("input");
                radio.type = "radio";
                radio.name = "principalIndex";
                radio.value = i;
                if(i === 0) radio.checked = true;
                label.appendChild(radio);
                label.appendChild(document.createTextNode(" " + file.name));
                radioContainer.appendChild(label);
            }
        } else {
            principalDiv.style.display = "none";
        }
    });
    
    submitBtn.addEventListener("click", function(e) {
        if(categorySelect.value === "") {
            e.preventDefault();
            categoryError.style.display = "block";
            categorySelect.style.border = "2px solid red";
        } else {
            categoryError.style.display = "none";
            categorySelect.style.border = "";
        }
    });
    
    categorySelect.addEventListener("change", function() {
        if(this.value !== "") {
            categoryError.style.display = "none";
            this.style.border = "";
        }
    });
</script>
}